{% extends "base.html" %}
{% load tracker_tags %}

{% block title %}Freelance Rate Calculator (Sweden){% endblock %}

{% block content %}
<h1>Freelance Rate Calculator (Sweden)</h1>
<p class="lead">Determine the hourly rate you need to charge to achieve your desired monthly salary.</p>

<div class="card mb-4">
    <div class="card-header">
        <h5>1. Your Financial Goals & Costs</h5>
    </div>
    <div class="card-body">
        <form method="get" id="incomeForm">
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="desired_salary" class="form-label">Desired Monthly Salary (SEK, before tax)</label>
                    <input type="number" name="desired_salary" id="desired_salary" class="form-control" value="{{ request.GET.desired_salary|default:40000 }}">
                </div>
                <div class="col-md-6">
                    <label for="overhead_costs" class="form-label">Monthly Business Costs (SEK)</label>
                    <input type="number" name="overhead_costs" id="overhead_costs" class="form-control" value="{{ request.GET.overhead_costs|default:2000 }}" placeholder="Software, insurance, etc.">
                </div>
                <div class="col-md-6">
                    <label for="billable_hours" class="form-label">Avg. Billable Hours per Month</label>
                    <input type="number" name="billable_hours" id="billable_hours" class="form-control" value="{{ request.GET.billable_hours|default:140 }}">
                </div>
                <div class="col-md-6">
                    <label for="municipal_tax" class="form-label">Your Municipal Tax Rate (%)</label>
                    <input type="number" name="municipal_tax" id="municipal_tax" class="form-control" value="{{ request.GET.municipal_tax|default:'32.0' }}" step="0.01">
                </div>
                <div class="col-md-6">
                    <label for="profit_margin" class="form-label">Profit Margin (%)</label>
                    <input type="number" name="profit_margin" id="profit_margin" class="form-control" value="{{ request.GET.profit_margin|default:10 }}" step="1">
                </div>
            </div>
            <div class="d-flex gap-2 mt-3">
                <button type="submit" class="btn btn-primary">Calculate My Rate</button>
            </div>
        </form>
    </div>
</div>

{% if hourly_rate_to_charge %}
<div class="row">
    <div class="col-lg-4 mb-4">
        <div class="card h-100 border-primary">
            <div class="card-body text-center">
                <h5 class="card-title">Your Target Hourly Rate</h5>
                <p class="display-4 fw-bold">{{ hourly_rate_to_charge|floatformat:0 }} <span class="fs-4 text-muted">SEK/hr</span></p>
                <small class="text-muted">(Excluding VAT/Moms)</small>
            </div>
        </div>
    </div>
    <div class="col-lg-8 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5>Rate Breakdown (Monthly Costs)</h5>
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">Your Salary (Brutto)<span>{{ desired_salary|floatformat:0 }} SEK</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Social Fees (Egenavgifter ~28.97%)<span>+ {{ social_fees|floatformat:0 }} SEK</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Vacation Pay (Semesterl√∂n ~12%)<span>+ {{ vacation_pay|floatformat:0 }} SEK</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Pension Savings (~4.5%)<span>+ {{ pension_savings|floatformat:0 }} SEK</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Sick Leave Buffer (~5%)<span>+ {{ sick_leave_buffer|floatformat:0 }} SEK</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Business Costs<span>+ {{ overhead_costs|floatformat:0 }} SEK</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center fw-bold">Total Monthly Cost<span>{{ total_monthly_cost|floatformat:0 }} SEK</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">Profit Margin ({{ profit_margin }}%)<span>+ {{ profit_amount|floatformat:0 }} SEK</span></li>
                    <li class="list-group-item d-flex justify-content-between align-items-center fw-bold bg-light">Total to Invoice Monthly<span>{{ total_to_invoice|floatformat:0 }} SEK</span></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>Your Personal Take-Home Pay Estimate</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-4">
                        <div class="stat">
                            <div class="stat-value fs-4">{{ desired_salary|floatformat:0 }} SEK</div>
                            <div class="stat-label">Gross Salary (Monthly)</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat">
                            <div class="stat-value fs-4 text-danger">- {{ total_tax_amount|floatformat:0 }} SEK</div>
                            <div class="stat-label">Estimated Income Tax ({{ municipal_tax }}%)</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat">
                            <div class="stat-value fs-4 text-success">{{ net_salary|floatformat:0 }} SEK</div>
                            <div class="stat-label">Net Salary (Monthly Take-Home)</div>
                        </div>
                    </div>
                </div>
                 <small class="text-muted d-block text-center mt-2">Note: State tax applies on income over {{ state_tax_threshold|floatformat:0 }} SEK/year. This is a simplified estimate.</small>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="text-center mt-4">
    <a href="{% url 'tracker:daily_earnings_tracker' %}" class="btn btn-outline-primary">Go to Daily Earnings Tracker &raquo;</a>
</div>

{% endblock %}

{% block extra_js %}
<script>
// All JS can be removed from this file as it was for the tracker form
</script>
{% endblock %}
